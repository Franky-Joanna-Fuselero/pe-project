{% import 'components/core/forms' as forms %}
{% from 'components/core/show-header' import show_header %}
{% from 'components/core/show-item' import show_item %}
{% set values = {} %}
{% set solution = null %}

<div id="MultipleChoice-content">
    {% for choice in question_type_data %}
        {% set values = values | merge({ (choice.choice_key): choice.item }) %}
        {% if choice.is_correct %}
            {% set solution = choice.choice_key %}
        {% endif %}
    {% endfor %}

    <div class="prose min-w-full">
        <h2>Sample View to Students</h2>
        <h3>{{ question.name|title }}</h3>
    </div>
    <div class="flex flex-col gap-y-2">
        {{ show_header('')}}
        {{ forms.form_field(
            input: forms.radio(
                name: 'multiple_choice',
                values: values,
                value: solution,
                attributes: {
                    'class': 'accent-blue-900 w-6 h-6 rounded-full'
                },
                label_attributes: {
                    'class': 'flex items-center gap-2 py-4 pl-4 pr-8 m-1 min-h-16 bg-gray-50 rounded-lg border border-gray-100 pointer-events-none select-none has-checked:bg-blue-900 has-checked:text-white has-checked:font-semibold'
                }
            ),
            isColumn: true
        ) }}

    {{ show_item('Solution', solution|title)}}
    </div>
</div>

<div id="TrueOrFalse-content">
    {% set values = {
        'true' : 'True',
        'false' : 'False',
    } %}
    {% set solution = question_type_data.solution %}
    <div class="prose min-w-full">
        <h2>Sample View to Students</h2>
        <h3>{{ question.name|title }}</h3>
    </div>
        <div class="flex flex-col gap-y-2">
            {{ show_header('')}}
                {{ forms.form_field(
                    input: forms.radio(
                        name: 'multiple_choice',
                        values: values,
                        value: solution,
                        attributes: {
                            'class': 'accent-blue-900 w-6 h-6 rounded-full'
                        },
                        label_attributes: {
                            'class': 'flex items-center gap-2 py-4 pl-4 pr-8 m-1 min-h-16 bg-gray-50 rounded-lg border border-gray-100 pointer-events-none select-none has-checked:bg-blue-900 has-checked:text-white has-checked:font-semibold'
                        }
                    ),
                    isColumn: true
                ) }}
            {{ show_item('Solution', solution|title)}}
        </div>
    </div>  
</div>

<div id="Identification-content">
{% set solution = question_type_data.solution %}
    <div class="prose min-w-full">
        <h2>Sample View to Students</h2>
        <h3>{{ question.name|title }}</h3>
    </div>
        <div class="flex flex-col gap-y-2">
            {{ show_header('')}}
                {{ forms.form_field(
                    label:forms.label(
                        id:'solution', 
                        content:'Solution', 
                        attributes:{
                            'class':'whitespace-nowrap text-sm/6 font-medium text-gray-900',}
                        ),
                    input:forms.text(
                        name:'solution', 
                        value: old('solution'), 
                        attributes:{
                            'class':'flex-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6',
                            'required':true}),
                    errors: errors.get('solution'),
                    isColumn:true
                )}}
            
            {{ show_item('Solution', solution|title)}}
        </div>
    </div>  
</div>

<div id="Ranking-content">
    {% set values = {} %}
    {% for choice in question_type_data %}
        {% set values = values | merge({ (choice.order): choice.item }) %}
    {% endfor %}

    <div class="prose min-w-full">
        <h2>Sample View to Students</h2>
        <h3>{{ question.name|title }}</h3>
    </div>
    {{ show_header('')}}
    <div class="sortable bg-gray-50 p-4 rounded-lg">
        {% for i in range(1, values|length) %}
            {{ forms.form_field(
                label:forms.label(
                    id: 'items[]', 
                    content:values[i-1], 
                    attributes:{
                        'class':'flex-1 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 cursor-move'}
                    ),
                input:forms.text(
                    name:'items[]',
                    value: values[i-1],
                    attributes:{
                        'class':'hidden',
                        'required':true
                    })
            )}}
        {% endfor %}
    </div>
    {{ show_item('Solution', solution|title)}}

    
<script>
    htmx.onLoad(function(content) {
        var sortables = content.querySelectorAll(".sortable");
        for (var i = 0; i < sortables.length; i++) {
        var sortable = sortables[i];
        var sortableInstance = new Sortable(sortable, {
            animation: 150,
            ghostClass: 'blue-background-class',

            // Make the `.htmx-indicator` unsortable
            filter: ".htmx-indicator",
            onMove: function (evt) {
                return evt.related.className.indexOf('htmx-indicator') === -1;
            }

            
        });

        // Re-enable sorting on the `htmx:afterSwap` event
        sortable.addEventListener("htmx:afterSwap", function() {
            sortableInstance.option("disabled", false);
        });
        }
    })
  </script>
</div>

<div id="Matching-content">
    Mathcing
</div>
  
<div id="Coding-content">
    <script>hljs.highlightAll();</script>
    {{ show_header('Sample View to Students')}}
    <div class="flex flex-1 flex-col max-w-full gap-y-4">
        <div class="flex">
            <div class="flex flex-1 md:w-4/5 flex-col prose prose-lg max-w-none">
                <h2><strong>{{ question.name }}</strong></h2>
            </div>
        </div>

        <div class="flex md:flex-row max-w-full w-full">
            <div class="flex flex-1 w-full md:w-1/2 flex-col rounded-xl shadow-sm ring-1 ring-gray-950/5">
                <div class="flex flex-1 rounded-t-md">
                    <div class="flex flex-col flex-1 w-full ">
                        <div class="flex w-full bg-gray-800 p-2 rounded-t-md justify-between">
                            <h1 class="text-gray-50 p-2 font-semibold text-lg">
                                Instruction
                            </h1>
                        </div>
                         <div class="flex-1 overflow-y-auto p-4 rounded-md border border-gray-200 prose prose-sm">
                            <p>{{ question_type_data.instruction|raw }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-1 w-full md:w-1/2  flex-col mx-8 rounded-xl bg-white p-4 shadow-sm ring-1 ring-gray-950/5">
                <div class="flex flex-col flex-1 min-w-0 ">
                    <div class="flex h-16 pb-4 justify-between">
                        <div class="flex">
                            {{ forms.form_field(
                                label:forms.label(
                                    id:'programming_language', 
                                    content:'Programming Language', 
                                    attributes:{
                                        'class':'whitespace-nowrap text-sm/6 font-medium text-gray-900 after:text-red-500 after:content-[\'\*\']'}
                                        ),
                                input:forms.select(
                                    name:'programming_language', 
                                    values:question_type_data.languages, 
                                    attributes:{
                                        'class':'flex-1 cursor-pointer block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6',
                                        'hx-on:change':'switchLanguageFromEvent(event)',
                                        'required':true
                                    }
                                )
                            )}}
                        </div>
                    </div>
                    
                    <div class="flex flex-col gap-y-4">
                        <div class="flex flex-1 flex-col rounded-md">
                            <div class="flex w-full bg-gray-800 p-2 rounded-t-md">
                                <p class="bg-gray-800 text-gray-50 font-semibold p-4 text-sm">Initial Solution</p>
                            </div>
                            <div class="flex">
                                <div class="flex-1 min-h-48 max-h-48 overflow-y-auto text-gray-500 border-1 border-gray-500"></div>
                            </div>
                        </div>

                        <div class="flex flex-1 flex-col rounded-md">
                            <div class="flex w-full bg-gray-800 p-2 justify-between rounded-t-md">
                                <p class="bg-gray-800 text-gray-50 font-semibold p-4 text-sm">Test Case</p>
                            </div>         
                            <div class="flex">
                                <div class="flex-1 min-h-48 max-h-48 overflow-y-auto text-gray-500 border-1 border-gray-500"></div>
                            </div>
                        </div>
                    </div>     
                </div>
            </div>
        </div>  

        {{ show_header('Supported Languages')}}
        <div class="flex w-full overflow-x-auto snap-x snap-mandatory space-x-4">
            {% for language, codes in question_type_data.language_codes %}
                <div class="flex flex-shrink-0 w-full snap-start flex-col bg-white p-4">
                    <div class="flex h-16 pb-4">
                            <p class="whitespace-nowrap text-xl font-bold text-gray-900">Language : {{ language|title }}</p>
                    </div>
                    
                    <div class="flex flex-col gap-y-4">
                        <div class="flex flex-1 flex-col rounded-md">
                            <div class="flex w-full bg-gray-800 p-2 rounded-t-md">
                                <p class="bg-gray-800 text-gray-50 font-semibold p-4 text-sm">Initial Solution</p>
                            </div>
                            <div class="flex border-1 border-gray-500">
                                <pre class="w-full"><code class="language-java">{{ codes.initial_solution }}</code></pre>
                            </div> 
                        </div>

                        <div class="flex flex-1 flex-col rounded-md">
                            <div class="flex w-full bg-gray-800 p-2 justify-between rounded-t-md">
                                <p class="bg-gray-800 text-gray-50 font-semibold p-4 text-sm">Sample Test Case</p>
                            </div>         
                            <div class="flex border-1 border-gray-500">     
                                <pre class="w-full"><code class="language-java">{{ codes.test_case }}</code></pre>
                            </div>
                        </div>

                        <div class="flex flex-1 flex-col rounded-md">
                            <div class="flex w-full bg-gray-800 p-2 rounded-t-md">
                                <p class="bg-gray-800 text-gray-50 font-semibold p-4 text-sm">Complete Solution</p>
                            </div>
                            <div class="flex border-1 border-gray-500">
                                <pre class="w-full"><code class="language-java">{{ codes.complete_solution }}</code></pre>
                            </div>
                        </div>
                    </div>     
                </div>
            {% endfor %}
        </div>  
    </div>
    
</div>